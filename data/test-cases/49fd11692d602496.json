{"uid":"49fd11692d602496","name":"Создание траты со всеми поддерживаемыми валютами через API","fullName":"tests.api.test_spends_api.TestSpendsApi#test_add_spend_all_currencies_api","historyId":"aaffd5339e1255e006d4a18c4929e494","time":{"start":1771494315009,"stop":1771494315009,"duration":0},"status":"broken","statusMessage":"requests.exceptions.HTTPError: 400 Client Error:  for url: http://localhost:9000/oauth2/authorize?response_type=code&client_id=client&scope=openid&redirect_uri=http%3A%2F%2Flocalhost%2Fauthorized&code_challenge=GdUnGWTZDHFtXCMd8zSWl4nEDUn6IU-d0UtL_PhSXt4&code_challenge_method=S256\n<!DOCTYPE HTML>\n<html lang=\"ru\" xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n    <title>Niffler auth error page</title>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"icon\" href=\"images/favicon.ico\"/>\n    <link href=\"styles/styles.css\" rel=\"stylesheet\"\n          type=\"text/css\"/>\n</head>\n<body>\n<main class=\"content\">\n    <div class=\"content__wrapper\">\n        <div class=\"main__hero\"></div>\n        <section class=\"main__form\">\n            <div class=\"logo-section\">\n                <img class=\"logo-section__logo\" src=\"images/coin.svg\" width=\"36\" alt=\"Niffler logo\"/>\n                <p class=\"logo-section__text\">\n                    Oops, an error occurred :(\n                </p>\n            </div>\n            <div class=\"form-section\">\n                <div class=\"form\" id=\"error-form\">\n                    <h1 class=\"header\">Code: 400</h1>\n                    <div class=\"form__error-container\">\n                        <p class=\"form__error\">Unknown error</p>\n                    </div>\n                    <p class=\"header__additional\">\n                        Let`s start from the <a class=\"form__link\" href=\"http://frontend.niffler.dc/main\">Niffler main page</a>\n                    </p>\n                </div>\n            </div>\n        </section>\n    </div>\n</main>\n</body>\n</html>","statusTrace":"envs = Envs(frontend_url='http://localhost', api_url='http://localhost:8090', auth_url='http://localhost:9000', spend_db_url=...localhost:8089/ws/userdata', kafka_address='localhost:9093', niffler_username='test_user', niffler_password='password')\ncreate_test_user_before_run = None\n\n    @pytest.fixture(scope=\"session\")\n    def auth_token(envs: Envs, create_test_user_before_run):\n>       return OAuthClient(envs).get_token(envs.niffler_username, envs.niffler_password)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nfixtures/auth_fixtures.py:8: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nclients/oauth_client.py:27: in get_token\n    self.session.get(\n../../../../.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/requests/sessions.py:602: in get\n    return self.request(\"GET\", url, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nutils/sessions.py:11: in wrapper\n    response.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400]>\n\n    def raise_for_status(self):\n        \"\"\"Raises :class:`HTTPError`, if one occurred.\"\"\"\n    \n        http_error_msg = \"\"\n        if isinstance(self.reason, bytes):\n            # We attempt to decode utf-8 first because some servers\n            # choose to localize their reason strings. If the string\n            # isn't utf-8, we fall back to iso-8859-1 for all other\n            # encodings. (See PR #3538)\n            try:\n                reason = self.reason.decode(\"utf-8\")\n            except UnicodeDecodeError:\n                reason = self.reason.decode(\"iso-8859-1\")\n        else:\n            reason = self.reason\n    \n        if 400 <= self.status_code < 500:\n            http_error_msg = (\n                f\"{self.status_code} Client Error: {reason} for url: {self.url}\"\n            )\n    \n        elif 500 <= self.status_code < 600:\n            http_error_msg = (\n                f\"{self.status_code} Server Error: {reason} for url: {self.url}\"\n            )\n    \n        if http_error_msg:\n>           raise HTTPError(http_error_msg, response=self)\nE           requests.exceptions.HTTPError: 400 Client Error:  for url: http://localhost:9000/oauth2/authorize?response_type=code&client_id=client&scope=openid&redirect_uri=http%3A%2F%2Flocalhost%2Fauthorized&code_challenge=GdUnGWTZDHFtXCMd8zSWl4nEDUn6IU-d0UtL_PhSXt4&code_challenge_method=S256\nE           <!DOCTYPE HTML>\nE           <html lang=\"ru\" xmlns=\"http://www.w3.org/1999/xhtml\">\nE           <head>\nE               <title>Niffler auth error page</title>\nE               <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\nE               <link rel=\"icon\" href=\"images/favicon.ico\"/>\nE               <link href=\"styles/styles.css\" rel=\"stylesheet\"\nE                     type=\"text/css\"/>\nE           </head>\nE           <body>\nE           <main class=\"content\">\nE               <div class=\"content__wrapper\">\nE                   <div class=\"main__hero\"></div>\nE                   <section class=\"main__form\">\nE                       <div class=\"logo-section\">\nE                           <img class=\"logo-section__logo\" src=\"images/coin.svg\" width=\"36\" alt=\"Niffler logo\"/>\nE                           <p class=\"logo-section__text\">\nE                               Oops, an error occurred :(\nE                           </p>\nE                       </div>\nE                       <div class=\"form-section\">\nE                           <div class=\"form\" id=\"error-form\">\nE                               <h1 class=\"header\">Code: 400</h1>\nE                               <div class=\"form__error-container\">\nE                                   <p class=\"form__error\">Unknown error</p>\nE                               </div>\nE                               <p class=\"header__additional\">\nE                                   Let`s start from the <a class=\"form__link\" href=\"http://frontend.niffler.dc/main\">Niffler main page</a>\nE                               </p>\nE                           </div>\nE                       </div>\nE                   </section>\nE               </div>\nE           </main>\nE           </body>\nE           </html>\n\n../../../../.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/requests/models.py:1026: HTTPError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"[S] Base Url","time":{"start":1771494313820,"stop":1771494313820,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"[S] Delete Output Dir","time":{"start":1771494313820,"stop":1771494313820,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"[S]  Session Faker","time":{"start":1771494313820,"stop":1771494313888,"duration":68},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"[S] Pytestconfig","time":{"start":1771494313820,"stop":1771494313820,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"[S]  Verify Url","time":{"start":1771494313820,"stop":1771494313820,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"[S] Envs","time":{"start":1771494313888,"stop":1771494313890,"duration":2},"status":"passed","steps":[],"attachments":[{"uid":"404c152b4d9116f6","name":"envs.json","source":"404c152b4d9116f6.json","type":"application/json","size":456}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"[S] Auth Client","time":{"start":1771494313890,"stop":1771494313890,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"[S] Create Test User Before Run","time":{"start":1771494313890,"stop":1771494314476,"duration":586},"status":"passed","steps":[{"name":"GET /register","time":{"start":1771494313903,"stop":1771494314184,"duration":281},"status":"passed","steps":[],"attachments":[{"uid":"26043795ea55b316","name":"SOAP Response","source":"26043795ea55b316.xml","type":"application/xml","size":3731},{"uid":"a342586a15b58916","name":"Request","source":"a342586a15b58916.html","type":"text/html","size":2012},{"uid":"fe83c0bee0046921","name":"Response 200","source":"fe83c0bee0046921.html","type":"text/html","size":4053},{"uid":"c59476251766fea0","name":"Response text 200","source":"c59476251766fea0.txt","type":"text/plain","size":3731}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},{"name":"POST /register","time":{"start":1771494314199,"stop":1771494314476,"duration":277},"status":"passed","steps":[],"attachments":[{"uid":"93edbbd7b3a3a4b3","name":"SOAP Response","source":"93edbbd7b3a3a4b3.xml","type":"application/xml","size":2279},{"uid":"e78ada7c5221cbe6","name":"Request","source":"e78ada7c5221cbe6.html","type":"text/html","size":2692},{"uid":"beb4228c1ecf9ef7","name":"Response 201","source":"beb4228c1ecf9ef7.html","type":"text/html","size":3839},{"uid":"16cee6179067e1c1","name":"Response text 201","source":"16cee6179067e1c1.txt","type":"text/plain","size":2279}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":2,"shouldDisplayMessage":false,"attachmentsCount":8,"hasContent":true,"attachmentStep":false},{"name":"[S] Auth Token","time":{"start":1771494314476,"stop":1771494314579,"duration":103},"status":"broken","statusMessage":"requests.exceptions.HTTPError: 400 Client Error:  for url: http://localhost:9000/oauth2/authorize?response_type=code&client_id=client&scope=openid&redirect_uri=http%3A%2F%2Flocalhost%2Fauthorized&code_challenge=GdUnGWTZDHFtXCMd8zSWl4nEDUn6IU-d0UtL_PhSXt4&code_challenge_method=S256\n\n<!DOCTYPE HTML>\n\n<html lang=\"ru\" xmlns=\"http://www.w3.org/1999/xhtml\">\n\n<head>\n\n    <title>Niffler auth error page</title>\n\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n\n    <link rel=\"icon\" href=\"images/favicon.ico\"/>\n\n    <link href=\"styles/styles.css\" rel=\"stylesheet\"\n\n          type=\"text/css\"/>\n\n</head>\n\n<body>\n\n<main class=\"content\">\n\n    <div class=\"content__wrapper\">\n\n        <div class=\"main__hero\"></div>\n\n        <section class=\"main__form\">\n\n            <div class=\"logo-section\">\n\n                <img class=\"logo-section__logo\" src=\"images/coin.svg\" width=\"36\" alt=\"Niffler logo\"/>\n\n                <p class=\"logo-section__text\">\n\n                    Oops, an error occurred :(\n\n                </p>\n\n            </div>\n\n            <div class=\"form-section\">\n\n                <div class=\"form\" id=\"error-form\">\n\n                    <h1 class=\"header\">Code: 400</h1>\n\n                    <div class=\"form__error-container\">\n\n                        <p class=\"form__error\">Unknown error</p>\n\n                    </div>\n\n                    <p class=\"header__additional\">\n\n                        Let`s start from the <a class=\"form__link\" href=\"http://frontend.niffler.dc/main\">Niffler main page</a>\n\n                    </p>\n\n                </div>\n\n            </div>\n\n        </section>\n\n    </div>\n\n</main>\n\n</body>\n\n</html>\n\n\n","statusTrace":"  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n          ^^^^^\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/_pytest/setuponly.py\", line 36, in pytest_fixture_setup\n    return (yield)\n            ^^^^^\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    return result.get_result()\n           ^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    raise exc.with_traceback(tb)\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n          ^^^^^\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/_pytest/fixtures.py\", line 1196, in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/_pytest/fixtures.py\", line 930, in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\n                     ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/niffler-py-st3/niffler-py-st3/niffler-e-2-e-tests-python/fixtures/auth_fixtures.py\", line 8, in auth_token\n    return OAuthClient(envs).get_token(envs.niffler_username, envs.niffler_password)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/niffler-py-st3/niffler-py-st3/niffler-e-2-e-tests-python/clients/oauth_client.py\", line 27, in get_token\n    self.session.get(\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/requests/sessions.py\", line 602, in get\n    return self.request(\"GET\", url, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/niffler-py-st3/niffler-py-st3/niffler-e-2-e-tests-python/utils/sessions.py\", line 11, in wrapper\n    response.raise_for_status()\n  File \"/home/runner/.cache/pypoetry/virtualenvs/niffler-e2e-tests-gpdX4pEC-py3.12/lib/python3.12/site-packages/requests/models.py\", line 1026, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\n","steps":[{"name":"GET /oauth2/authorize","time":{"start":1771494314489,"stop":1771494314579,"duration":90},"status":"passed","steps":[],"attachments":[{"uid":"c115b4401a6ba9af","name":"SOAP Response","source":"c115b4401a6ba9af.xml","type":"application/xml","size":1338},{"uid":"afce61c9f6e209d3","name":"Request","source":"afce61c9f6e209d3.html","type":"text/html","size":2298},{"uid":"54e2ce2d8f90f8cd","name":"Response 400","source":"54e2ce2d8f90f8cd.html","type":"text/html","size":3758},{"uid":"d392af9855b16f28","name":"Response text 400","source":"d392af9855b16f28.txt","type":"text/plain","size":1338}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":4,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":1,"shouldDisplayMessage":true,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},{"name":"[S] Spend Db","time":{"start":1771494319130,"stop":1771494319131,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[],"labels":[{"name":"story","value":"API"},{"name":"feature","value":"Таблица трат"},{"name":"host","value":"runnervmjduv7"},{"name":"thread","value":"10512-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.api.test_spends_api"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"currency","value":"'USD'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"49fd11692d602496.json","parameterValues":["'USD'"]}